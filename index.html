<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sky Catch Challenge</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM (æ ¸å¿ƒåº«) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. å¼•å…¥ Babel (è®“ç€è¦½å™¨èƒ½çœ‹æ‡‚ React ç¨‹å¼ç¢¼) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* é˜²æ­¢æ‰‹æ©Ÿä¸Šä¸‹æ‹‰å‹•é‡æ–°æ•´ç† */
      body {
        overscroll-behavior-y: contain;
        touch-action: none;
      }
      /* ç¢ºä¿æ»¿ç‰ˆ */
      html, body, #root {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      /* ç¦æ­¢é¸å–æ–‡å­— */
      .select-none {
        user-select: none;
        -webkit-user-select: none;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-900 text-white">
    <div id="root"></div>

    <!-- 4. ä¸»è¦ç¨‹å¼ç¢¼é‚è¼¯ (type="text/babel") -->
    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useRef, useCallback } = React;

      // ==========================================
      // 1. å¸¸æ•¸å®šç¾© (Constants)
      // ==========================================
      const GAME_DURATION = 30; // éŠæˆ²æ™‚é–“ (ç§’)
      const WINNING_SCORE = 200; // ç›®æ¨™åˆ†æ•¸
      const COUPON_VALUE = 50; // æŠ˜åƒ¹åˆ¸é¢é¡

      // ç•«å¸ƒé‚è¼¯å¤§å° (æœƒè‡ªå‹•ç¸®æ”¾åˆ°è¢å¹•)
      const CANVAS_WIDTH = 480;
      const CANVAS_HEIGHT = 800;

      const PLAYER_WIDTH = 100; // é›™æ‰‹å¯¬åº¦
      const PLAYER_HEIGHT = 60;
      const PLAYER_Y_OFFSET = 120; // è·é›¢åº•éƒ¨çš„è·é›¢

      const ITEM_SIZE = 45; // æ‰è½ç‰©å¤§å°
      const BULLET_SIZE = 12; // å­å½ˆå¤§å°
      const BULLET_SPEED = 15; // å­å½ˆé€Ÿåº¦

      // åˆ†æ•¸å°ç…§è¡¨
      const SCORE_MAP = {
        FOOD_BURGER: 20,
        FOOD_PIZZA: 20,
        ENEMY_X: -5,
        ENEMY_SKULL: -10,
      };

      const ItemType = {
        FOOD_BURGER: 'FOOD_BURGER',
        FOOD_PIZZA: 'FOOD_PIZZA',
        ENEMY_X: 'ENEMY_X',
        ENEMY_SKULL: 'ENEMY_SKULL',
      };

      const GameScreen = {
        HOME: 'HOME',
        PLAYING: 'PLAYING',
        RESULT: 'RESULT',
      };

      // ==========================================
      // 2. é€šç”¨å…ƒä»¶ (Components)
      // ==========================================
      
      const Button = ({ onClick, children, className = '', variant = 'primary' }) => {
        const baseStyle = "px-8 py-3 rounded-full font-bold text-lg transition-transform active:scale-95 shadow-lg select-none";
        
        const variants = {
          primary: "bg-gradient-to-r from-yellow-400 to-orange-500 text-white hover:from-yellow-500 hover:to-orange-600 border-2 border-orange-300",
          secondary: "bg-white text-slate-800 hover:bg-gray-100 border-2 border-slate-200",
          danger: "bg-red-500 text-white hover:bg-red-600 border-2 border-red-400",
        };

        return (
          <button 
            onClick={onClick} 
            className={`${baseStyle} ${variants[variant]} ${className}`}
          >
            {children}
          </button>
        );
      };

      // ==========================================
      // 3. é é¢å…ƒä»¶: é¦–é  (Home)
      // ==========================================
      const Home = ({ onStart }) => {
        return (
          <div className="flex flex-col items-center justify-center h-full w-full p-6 bg-gradient-to-b from-sky-400 to-blue-600 text-center space-y-6 select-none">
            <div className="space-y-2 animate-bounce">
              <h1 className="text-4xl font-extrabold text-white drop-shadow-md">
                æ¥ä½ç¾å‘³
                <br />
                <span className="text-yellow-300">å¤§ä½œæˆ°</span>
              </h1>
            </div>

            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/20 w-full max-w-sm shadow-xl">
              <h2 className="text-xl font-bold mb-3 text-yellow-200 border-b border-white/20 pb-2">ğŸ® éŠæˆ²ç©æ³•</h2>
              <ul className="text-left space-y-3 text-white/95 text-sm leading-relaxed font-medium">
                <li className="flex items-center bg-black/20 p-2 rounded-lg">
                  <span className="mr-3 text-2xl">ğŸ‘</span>
                  <span>å·¦å³æ»‘å‹•æ¥ä½ç¾é£Ÿ</span>
                </li>
                <li className="flex items-center bg-green-500/20 p-2 rounded-lg border border-green-400/30">
                  <span className="mr-3 text-2xl">ğŸ”</span>
                  <span>ç¾å‘³é£Ÿç‰© <b>+20åˆ†</b></span>
                </li>
                <li className="flex items-center bg-red-500/20 p-2 rounded-lg border border-red-400/30">
                  <span className="mr-3 text-2xl">âŒ</span>
                  <span>é™·é˜±æ‰£åˆ† (X: -5, éª·é«: -10)</span>
                </li>
                <li className="flex items-center bg-blue-500/20 p-2 rounded-lg border border-blue-400/30">
                  <span className="mr-3 text-2xl">ğŸ”«</span>
                  <span><b>é»æ“Šç•«é¢</b>å°„æ“Šæ¶ˆé™¤å£æ±è¥¿ï¼</span>
                </li>
              </ul>
            </div>

            <div className="bg-gradient-to-r from-yellow-500/80 to-orange-500/80 rounded-xl p-4 border-2 border-yellow-200 shadow-lg transform scale-105">
              <p className="font-bold text-white text-sm uppercase tracking-wider">
                ğŸ† æŒ‘æˆ°ç›®æ¨™ï¼š{WINNING_SCORE} åˆ†
              </p>
              <p className="text-white font-black text-2xl mt-1">
                è´å– ${COUPON_VALUE} æŠ˜åƒ¹åˆ¸ï¼
              </p>
            </div>

            <Button onClick={onStart} className="w-full max-w-xs shadow-2xl shadow-blue-900/40 mt-4">
              é–‹å§‹æŒ‘æˆ° (30ç§’)
            </Button>
          </div>
        );
      };

      // ==========================================
      // 4. é é¢å…ƒä»¶: çµç®—é  (Result)
      // ==========================================
      const Result = ({ score, onRestart }) => {
        const isWinner = score >= WINNING_SCORE;

        return (
          <div className="flex flex-col items-center justify-center h-full w-full p-6 bg-gradient-to-b from-indigo-500 to-purple-800 text-center space-y-8 select-none">
            
            <div className="space-y-2">
              <h2 className="text-3xl font-bold text-white/80">éŠæˆ²çµæŸ</h2>
              <div className="text-7xl font-black text-white drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)]">
                {score} <span className="text-2xl font-medium">åˆ†</span>
              </div>
            </div>

            {isWinner ? (
              <div className="bg-gradient-to-br from-yellow-300 to-yellow-600 text-white p-6 rounded-2xl shadow-2xl transform rotate-1 border-4 border-white w-full max-w-xs relative overflow-hidden group">
                <div className="absolute top-0 left-0 w-full h-full bg-white opacity-20 rotate-45 transform translate-y-10 group-hover:translate-y-0 transition-transform duration-700"></div>
                <h3 className="text-3xl font-bold mb-2">ğŸ‰ æ­å–œé”æˆï¼</h3>
                <p className="mb-4 font-medium text-yellow-50">æŒ‘æˆ°æˆåŠŸï¼Œé€™æ˜¯æ‚¨çš„çå‹µ</p>
                <div className="bg-white text-slate-900 font-mono font-bold text-2xl py-4 px-4 rounded-lg border-2 border-dashed border-slate-400 shadow-inner">
                  ${COUPON_VALUE} æŠ˜åƒ¹åˆ¸
                </div>
                <p className="text-xs mt-3 opacity-90 font-bold bg-black/10 py-1 rounded">* è«‹æˆªåœ–æ­¤ç•«é¢ä»¥é€²è¡Œå…Œæ› *</p>
              </div>
            ) : (
              <div className="bg-white/10 backdrop-blur-md p-8 rounded-3xl border border-white/20 w-full max-w-xs shadow-xl">
                <div className="text-6xl mb-4 animate-pulse">ğŸ’ª</div>
                <h3 className="text-2xl font-bold text-white mb-2">å†æ¥å†å²ï¼</h3>
                <p className="text-indigo-200 text-lg">
                  è·é›¢ {WINNING_SCORE} åˆ†<br/>
                  åªå·®ä¸€é»é»äº†ï¼
                </p>
              </div>
            )}

            <Button onClick={onRestart} variant={isWinner ? 'secondary' : 'primary'} className="w-full max-w-xs">
              {isWinner ? 'å¤ªæ£’äº†ï¼Œå†ç©ä¸€æ¬¡' : 'ä¸æœè¼¸ï¼Œå†ä¾†ä¸€å±€ï¼'}
            </Button>
          </div>
        );
      };

      // ==========================================
      // 5. æ ¸å¿ƒéŠæˆ²é‚è¼¯ (Game Engine)
      // ==========================================
      const Game = ({ onFinish }) => {
        const canvasRef = useRef(null);
        
        // éŠæˆ²ç‹€æ…‹ (ä½¿ç”¨ ref é¿å… React é‡è¤‡æ¸²æŸ“å°è‡´çš„æ•ˆèƒ½å•é¡Œ)
        const gameStateRef = useRef({
          score: 0,
          playerX: CANVAS_WIDTH / 2,
          items: [], // æ‰è½ç‰©
          bullets: [], // å­å½ˆ
          lastTime: 0,
          lastUiSyncTime: 0,
          timeLeft: GAME_DURATION,
          isPlaying: true,
        });

        // ç”Ÿæˆå™¨åˆ—è¡¨ (æƒ¡é­”èˆ‡å»šå¸«)
        const spawnersRef = useRef([]);

        // React State ç”¨æ–¼æ›´æ–° UI ä»‹é¢ (åˆ†æ•¸ã€æ™‚é–“)
        const [uiScore, setUiScore] = useState(0);
        const [uiTime, setUiTime] = useState(GAME_DURATION);

        // åˆå§‹åŒ–ç”Ÿæˆå™¨
        useEffect(() => {
          spawnersRef.current = [
            { id: 'demon-1', x: 50, y: 80, direction: 1, type: 'DEMON', nextSpawnTime: 0 },
            { id: 'chef-1', x: CANVAS_WIDTH - 50, y: 80, direction: -1, type: 'CHEF', nextSpawnTime: 0 }
          ];
        }, []);

        // è¼”åŠ©å‡½å¼: ç”Ÿæˆæ‰è½ç‰©
        const spawnItem = (spawner) => {
          const isDemon = spawner.type === 'DEMON';
          let type;
          
          if (isDemon) {
            // æƒ¡é­”ä¸Ÿå£æ±è¥¿
            type = Math.random() > 0.6 ? ItemType.ENEMY_SKULL : ItemType.ENEMY_X;
          } else {
            // å»šå¸«ä¸Ÿå¥½æ±è¥¿
            type = Math.random() > 0.5 ? ItemType.FOOD_BURGER : ItemType.FOOD_PIZZA;
          }

          // éŠæˆ²é€²åº¦ (0 ~ 1)
          const progress = 1 - (gameStateRef.current.timeLeft / GAME_DURATION);
          // éš¨è‘—æ™‚é–“å¢åŠ ï¼Œæ‰è½é€Ÿåº¦åŠ å¿« (åŸºç¤3 -> æœ€å¿«8)
          const itemSpeed = 3 + (progress * 5); 

          gameStateRef.current.items.push({
            id: Date.now() + Math.random(),
            x: spawner.x,
            y: spawner.y + 20,
            width: ITEM_SIZE,
            height: ITEM_SIZE,
            type,
            speed: itemSpeed,
            active: true,
          });
        };

        // è¼”åŠ©å‡½å¼: è¨ˆç®—ä¸‹æ¬¡ç”Ÿæˆæ™‚é–“ (éš¨æ™‚é–“è®ŠçŸ­)
        const getNextSpawnDelay = (timeLeft) => {
          const progress = 1 - (timeLeft / GAME_DURATION);
          // åŸºç¤å»¶é²å¾ 1.5ç§’ é™åˆ° 0.4ç§’
          const baseDelay = 1500 - (progress * 1100); 
          const jitter = Math.random() * 500; // éš¨æ©Ÿæ“¾å‹•
          return baseDelay + jitter;
        };

        // è¼”åŠ©å‡½å¼: ç¢°æ’æª¢æ¸¬ (çŸ©å½¢)
        const isColliding = (rect1, rect2) => {
          return (
            rect1.x < rect2.x + rect2.width &&
            rect1.x + rect1.width > rect2.x &&
            rect1.y < rect2.y + rect2.height &&
            rect1.y + rect1.height > rect2.y
          );
        };

        // éŠæˆ²ä¸»è¿´åœˆ (Game Loop)
        const gameLoop = useCallback((timestamp) => {
          if (!gameStateRef.current.isPlaying) return;
          const canvas = canvasRef.current;
          if (!canvas) return;
          const ctx = canvas.getContext('2d');
          if (!ctx) return;

          const state = gameStateRef.current;
          
          if (state.lastTime === 0) {
            state.lastTime = timestamp;
            // è¨­å®šåˆå§‹ç”Ÿæˆæ™‚é–“
            spawnersRef.current.forEach(s => {
              s.nextSpawnTime = timestamp + Math.random() * 1000;
            });
          }

          const deltaTime = timestamp - state.lastTime;
          state.lastTime = timestamp;

          // --- é‚è¼¯æ›´æ–° ---
          
          // 1. å€’æ•¸è¨ˆæ™‚
          state.timeLeft -= deltaTime / 1000;
          if (state.timeLeft <= 0) {
            state.isPlaying = false;
            onFinish(state.score);
            return;
          }

          // 2. å‹•æ…‹é›£åº¦èª¿æ•´ (å¢åŠ æƒ¡é­”æ•¸é‡)
          const elapsed = GAME_DURATION - state.timeLeft;
          // 10ç§’å¾Œå¢åŠ ç¬¬äºŒå€‹æƒ¡é­”
          if (elapsed > 10 && spawnersRef.current.filter(s => s.type === 'DEMON').length < 2) {
             spawnersRef.current.push({
               id: 'demon-2',
               x: CANVAS_WIDTH / 2,
               y: 80,
               direction: Math.random() > 0.5 ? 1 : -1,
               type: 'DEMON',
               nextSpawnTime: timestamp + 2000
             });
          }
          // 20ç§’å¾Œå¢åŠ ç¬¬ä¸‰å€‹æƒ¡é­”
          if (elapsed > 20 && spawnersRef.current.filter(s => s.type === 'DEMON').length < 3) {
             spawnersRef.current.push({
               id: 'demon-3',
               x: 40,
               y: 80,
               direction: 1,
               type: 'DEMON',
               nextSpawnTime: timestamp + 2000
             });
          }

          // 3. æ›´æ–°ç”Ÿæˆå™¨ä½ç½®èˆ‡ç”Ÿæˆç‰©å“
          spawnersRef.current.forEach(spawner => {
            spawner.x += spawner.direction * 3; 
            // é‚Šç•Œåå½ˆ
            if (spawner.x < 40 || spawner.x > CANVAS_WIDTH - 40) {
              spawner.direction *= -1;
            }

            // ç”Ÿæˆç‰©å“æª¢æŸ¥
            if (timestamp >= spawner.nextSpawnTime) {
              spawnItem(spawner);
              spawner.nextSpawnTime = timestamp + getNextSpawnDelay(state.timeLeft);
            }
          });

          // 4. æ›´æ–°æ‰è½ç‰© (ç§»å‹•èˆ‡ç¢°æ’)
          const playerHitbox = {
            x: state.playerX - PLAYER_WIDTH / 2 + 10, // ç¨å¾®ç¸®å°ç¢°æ’ç®±è®“åˆ¤å®šå¯¬é¬†ä¸€é»
            y: CANVAS_HEIGHT - PLAYER_Y_OFFSET,
            width: PLAYER_WIDTH - 20,
            height: PLAYER_HEIGHT
          };

          state.items.forEach(item => {
            item.y += item.speed;
            
            // ç¢°åˆ°ç©å®¶
            if (item.active && isColliding(item, playerHitbox)) {
              item.active = false;
              state.score += SCORE_MAP[item.type];
              
              // ç°¡å–®çš„ç‰¹æ•ˆå›é¥‹ (å¯é¸)
              // console.log("Hit", item.type);
            }

            // è¶…å‡ºé‚Šç•Œ
            if (item.y > CANVAS_HEIGHT) item.active = false;
          });

          // 5. æ›´æ–°å­å½ˆ
          state.bullets.forEach(bullet => {
            bullet.y -= bullet.speed;
            
            // å­å½ˆæ‰“åˆ°æ‰è½ç‰©
            state.items.forEach(item => {
              if (item.active && bullet.active && isColliding(bullet, item)) {
                item.active = false;
                bullet.active = false;
                // æ‰“æ‰ä¸åŠ åˆ†ä¹Ÿä¸æ‰£åˆ†
              }
            });

            if (bullet.y < 0) bullet.active = false;
          });

          // æ¸…ç†ç„¡æ•ˆç‰©ä»¶
          state.items = state.items.filter(i => i.active);
          state.bullets = state.bullets.filter(b => b.active);

          // --- ç•«é¢æ¸²æŸ“ ---
          ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

          // ç•«ç”Ÿæˆå™¨ (æƒ¡é­”/å»šå¸«)
          ctx.font = '50px Arial';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          spawnersRef.current.forEach(spawner => {
            const icon = spawner.type === 'DEMON' ? 'ğŸ˜ˆ' : 'ğŸ‘¨â€ğŸ³';
            // ç°¡å–®çš„æµ®å‹•å‹•ç•«
            const bob = Math.sin(timestamp / 200) * 5;
            ctx.fillText(icon, spawner.x, spawner.y + bob);
          });

          // ç•«æ‰è½ç‰©
          state.items.forEach(item => {
            let icon = '';
            switch(item.type) {
              case ItemType.FOOD_BURGER: icon = 'ğŸ”'; break;
              case ItemType.FOOD_PIZZA: icon = 'ğŸ•'; break;
              case ItemType.ENEMY_X: icon = 'âŒ'; break;
              case ItemType.ENEMY_SKULL: icon = 'ğŸ’€'; break;
            }
            ctx.font = `${ITEM_SIZE}px Arial`;
            ctx.fillText(icon, item.x + item.width/2, item.y + item.height/2);
          });

          // ç•«å­å½ˆ
          ctx.fillStyle = '#fbbf24'; // amber-400
          state.bullets.forEach(bullet => {
            ctx.beginPath();
            ctx.arc(bullet.x + bullet.width/2, bullet.y + bullet.height/2, BULLET_SIZE/2, 0, Math.PI * 2);
            ctx.fill();
            // å­å½ˆå…‰æšˆ
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'orange';
            ctx.fill();
            ctx.shadowBlur = 0;
          });

          // ç•«ç©å®¶ (é›™æ‰‹)
          ctx.font = '70px Arial';
          ctx.fillText('ğŸ‘', state.playerX, CANVAS_HEIGHT - PLAYER_Y_OFFSET + 30);
          
          // ç•«åœ°æ¿ç·šæ¢æš—ç¤º
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(0, CANVAS_HEIGHT - PLAYER_Y_OFFSET + 60);
          ctx.lineTo(CANVAS_WIDTH, CANVAS_HEIGHT - PLAYER_Y_OFFSET + 60);
          ctx.stroke();

          // --- UI åŒæ­¥ (æ¯ 100ms æ›´æ–°ä¸€æ¬¡ React State ä»¥ç¯€çœæ•ˆèƒ½) ---
          if (timestamp - state.lastUiSyncTime > 100) {
            setUiScore(state.score);
            setUiTime(Math.max(0, Math.ceil(state.timeLeft)));
            state.lastUiSyncTime = timestamp;
          }

          requestAnimationFrame(gameLoop);
        }, [onFinish]);

        // è¼¸å…¥è™•ç†: ç§»å‹•
        const handleInput = useCallback((clientX) => {
          const canvas = canvasRef.current;
          if (!canvas) return;
          
          const rect = canvas.getBoundingClientRect();
          // è¨ˆç®—ç•«å¸ƒç¸®æ”¾æ¯”ä¾‹
          const scaleX = CANVAS_WIDTH / rect.width;
          const canvasX = (clientX - rect.left) * scaleX;

          // é™åˆ¶ç§»å‹•ç¯„åœ
          gameStateRef.current.playerX = Math.max(
            PLAYER_WIDTH/2, 
            Math.min(CANVAS_WIDTH - PLAYER_WIDTH/2, canvasX)
          );
        }, []);

        // è¼¸å…¥è™•ç†: å°„æ“Š
        const handleShoot = useCallback(() => {
          if (!gameStateRef.current.isPlaying) return;
          
          gameStateRef.current.bullets.push({
            id: Date.now() + Math.random(),
            x: gameStateRef.current.playerX - BULLET_SIZE / 2, // å¾ç©å®¶ä¸­å¿ƒç™¼å°„
            y: CANVAS_HEIGHT - PLAYER_Y_OFFSET,
            width: BULLET_SIZE,
            height: BULLET_SIZE,
            speed: BULLET_SPEED,
            active: true,
          });
        }, []);

        // å•Ÿå‹•èˆ‡æ¸…ç†
        useEffect(() => {
          gameStateRef.current.lastTime = 0;
          gameStateRef.current.isPlaying = true;
          
          const animId = requestAnimationFrame(gameLoop);
          
          // æ‰‹æŒ‡æ‹–å‹•
          const onTouchMove = (e) => {
            e.preventDefault(); 
            if(e.touches.length > 0) {
              handleInput(e.touches[0].clientX);
            }
          };
          
          // æ»‘é¼ ç§»å‹•
          const onMouseMove = (e) => {
            handleInput(e.clientX);
          };

          const canvas = canvasRef.current;
          if (canvas) {
            canvas.addEventListener('touchmove', onTouchMove, { passive: false });
            canvas.addEventListener('mousemove', onMouseMove);
          }

          return () => {
            cancelAnimationFrame(animId);
            gameStateRef.current.isPlaying = false;
            if (canvas) {
              canvas.removeEventListener('touchmove', onTouchMove);
              canvas.removeEventListener('mousemove', onMouseMove);
            }
          };
        }, [gameLoop, handleInput]);

        return (
          <div className="relative w-full h-full bg-slate-900 overflow-hidden flex justify-center items-center">
            {/* æŠ¬é ­é¡¯ç¤ºå™¨ (HUD) */}
            <div className="absolute top-0 w-full md:max-w-[480px] p-4 flex justify-between z-10 pointer-events-none">
              <div className="bg-black/50 text-white px-4 py-2 rounded-full border border-white/20 font-mono text-xl font-bold flex items-center shadow-lg">
                â³ {uiTime}s
              </div>
              <div className={`px-4 py-2 rounded-full border font-mono text-xl font-bold flex items-center shadow-lg transition-colors duration-300 ${
                uiScore >= 200 
                  ? 'bg-yellow-500 text-white border-yellow-300 shadow-yellow-500/50' 
                  : 'bg-black/50 text-white border-white/20'
              }`}>
                Score: {uiScore}
              </div>
            </div>

            {/* éŠæˆ²ç•«å¸ƒ */}
            <canvas
              ref={canvasRef}
              width={CANVAS_WIDTH}
              height={CANVAS_HEIGHT}
              className="h-full w-full md:max-w-[480px] bg-gradient-to-b from-slate-800 to-slate-900 cursor-crosshair touch-none shadow-2xl"
              // æ”¯æ´æ»‘é¼ é»æ“Šå°„æ“Š
              onMouseDown={handleShoot}
              // æ”¯æ´æ‰‹æ©Ÿè§¸æ§é»æ“Šå°„æ“Š (åŒæ™‚ä¹Ÿæœƒè§¸ç™¼ touchmove ç§»å‹•)
              onTouchStart={(e) => {
                handleInput(e.touches[0].clientX);
                handleShoot();
              }}
            />
            
            <div className="absolute bottom-6 text-white/40 text-sm pointer-events-none animate-pulse">
              [ é»æ“Šå°„æ“Š ] â€¢ [ æ»‘å‹•ç§»å‹• ]
            </div>
          </div>
        );
      };

      // ==========================================
      // 6. æ‡‰ç”¨ç¨‹å¼å…¥å£ (App)
      // ==========================================
      const App = () => {
        const [screen, setScreen] = useState(GameScreen.HOME);
        const [lastScore, setLastScore] = useState(0);

        const startGame = () => {
          setScreen(GameScreen.PLAYING);
        };

        const finishGame = (score) => {
          setLastScore(score);
          setScreen(GameScreen.RESULT);
        };

        const restartGame = () => {
          setScreen(GameScreen.HOME);
        };

        return (
          <div className="h-full w-full flex items-center justify-center bg-gray-950">
            {/* æ‰‹æ©Ÿå¤–æ¡†å®¹å™¨ (åœ¨æ¡Œæ©Ÿä¸Šé™åˆ¶å¯¬åº¦) */}
            <div className="w-full h-full md:max-w-[480px] md:max-h-[850px] bg-slate-900 md:rounded-3xl shadow-2xl overflow-hidden relative border-4 border-slate-800">
              {screen === GameScreen.HOME && <Home onStart={startGame} />}
              {screen === GameScreen.PLAYING && <Game onFinish={finishGame} />}
              {screen === GameScreen.RESULT && <Result score={lastScore} onRestart={restartGame} />}
            </div>
          </div>
        );
      };

      // æ¸²æŸ“åˆ° root
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>